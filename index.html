<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Candy Time</title>
<link rel="manifest" href="appmanifest.json" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link rel="apple-touch-icon" sizes="256x256" href="icon-256.png" />
<meta name="HandheldFriendly" content="true" />
<meta name="mobile-web-app-capable" content="yes" />
<link rel="shortcut icon" sizes="256x256" href="icon-256.png" />

<style>
*{padding:0;margin:0;}
html,body{
width:100%;height:100%;
background:url("images/sprite-sheet0.png") no-repeat center center;
background-size:cover;
background-attachment:fixed;
color:#fff;
overflow:hidden;
touch-action:none;
-ms-touch-action:none;
}
canvas{width:100%;height:100%;touch-action:none;-ms-touch-action:none;}

/* Privacy button */
#privacyBtn{
position:fixed;
bottom:20px;
right:15px;
padding:8px 14px;
font-size:12px;
border-radius:12px;
border:none;
background:rgba(0,0,0,.55);
color:#fff;
z-index:99999;
opacity:.85;
}
#privacyBtn:active{opacity:1;}
</style>
</head>

<body>
<div id="fb-root"></div>

<div id="c2canvasdiv">
<canvas id="c2canvas" width="720" height="1280"></canvas>
</div>

<!-- Privacy Policy Button -->
<button id="privacyBtn">Privacy Policy</button>

<script src="jquery-3.4.1.min.js"></script>
<script src="c2runtime.js"></script>

<script>
jQuery(document).ready(function ()
{
    cr_createRuntime("c2canvas");

    function waitForRuntime(callback){
        const interval=setInterval(()=>{
            if(window.cr_getC2Runtime && cr_getC2Runtime().globalVars){
                clearInterval(interval);
                callback();
            }
        },100);
    }

    waitForRuntime(()=>{
        let sentGameOver=false;
        let lastScore=null;

        function sendToApp(event,data){
            if(window.Android && Android.onGameEvent){
                Android.onGameEvent(JSON.stringify({
                    event:event,
                    data:data,
                    time:Date.now()
                }));
            }
        }

        function pollGame(){
            const rt=cr_getC2Runtime();
            const gv=rt.globalVars;

            const score=gv.Score?.value||0;
            const record=gv.record?.value||0;
            const gameOn=gv.GameOn?.value||0;
            const timer=gv.Timer?.value||0;

            if(gameOn===0 && score>0 && !sentGameOver){
                sentGameOver=true;
                sendToApp("game_over",{score,record,time:timer});
            }

            if(lastScore!==score){
                lastScore=score;
                sendToApp("live_score",{score});
            }
        }

        setInterval(pollGame,400);
    });
});

/* Pause/Resume */
function onVisibilityChanged(){
    if(document.hidden) cr_setSuspended(true);
    else cr_setSuspended(false);
}
document.addEventListener("visibilitychange",onVisibilityChanged,false);

/* Privacy Policy Click */
document.getElementById("privacyBtn").addEventListener("click",function(){

    var url="YOUR_PRIVACY_LINK"; // <-- CHANGE THIS

    if(window.Android && Android.openExternal){
        Android.openExternal(url);
    }else{
        window.open(url,"_blank");
    }
});
</script>

</body>
</html>
